// lib/data/levelBasedOrders.ts
import { CHEMICAL_REACTIONS, ChemicalReaction } from './reactions';

// å®¢ã‚¿ã‚¤ãƒ—ã®å®šç¾©
export type CustomerType = 'normal' | 'rare' | 'super rare' | 'vip';

export interface CustomerTypeConfig {
  name: string;
  molMultiplier: number;
  bonusMultiplier: number;
  probability: number;
  displayName: string;
  emoji: string;
}

export const CUSTOMER_TYPES: Record<CustomerType, CustomerTypeConfig> = {
  'normal': {
    name: 'normal',
    molMultiplier: 1.0,
    bonusMultiplier: 1.0,
    probability: 0.60, // 60%
    displayName: 'Normalå®¢',
    emoji: 'ğŸ‘¨â€ğŸ”¬'
  },
  'rare': {
    name: 'rare',
    molMultiplier: 5.0,
    bonusMultiplier: 2.0,
    probability: 0.25, // 25%
    displayName: 'Rareå®¢',
    emoji: 'ğŸ‘¨â€ğŸ”¬'
  },
  'super rare': {
    name: 'super rare',
    molMultiplier: 10.0,
    bonusMultiplier: 3.0,
    probability: 0.10, // 10%
    displayName: 'Super Rareå®¢',
    emoji: 'ğŸ‘¨â€ğŸ”¬'
  },
  'vip': {
    name: 'vip',
    molMultiplier: 1.0,
    bonusMultiplier: 5.0,
    probability: 0.05, // 5%
    displayName: 'VIPå®¢',
    emoji: 'ğŸ‘¨â€ğŸ”¬'
  }
};

export interface LevelBasedOrder {
  level: number;
  reactionId: number;
  targetProduct: string;
  targetMol: number;
  orderText: string;
  specialInstruction?: string; // level2ç”¨ã®ææ–™æŒ‡å®š
  reaction: ChemicalReaction;
  bonusMultiplier?: number; // VIPãƒœãƒ¼ãƒŠã‚¹
  isLegend?: boolean; // VIPå®¢ãƒ•ãƒ©ã‚°
  customerType: CustomerType;
  customerComment: string;
}

// å„åå¿œã‹ã‚‰æ³¨æ–‡ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function createOrderFromReaction(reaction: ChemicalReaction, targetProductIndex: number = 0): any {
  const product = reaction.products[targetProductIndex];
  const productName = getProductDisplayName(product.formula);
  
  // level2ï¼ˆæœ‰æ©ŸåŒ–åˆç‰©ç‡ƒç„¼ï¼‰ã®å ´åˆã¯ææ–™æŒ‡å®š
  if (reaction.level === 2) {
    const organicReactant = reaction.reactants.find(r => 
      ['CH4', 'C2H6', 'C3H8', 'C2H4', 'C2H2', 'C6H6', 'C4H10'].includes(r.formula)
    );
    
    if (organicReactant) {
      const reactantName = getProductDisplayName(organicReactant.formula);
      return {
        reactionId: reaction.id,
        targetProduct: product.formula,
        orderText: `${reactantName}ã‚’ç”¨ã„ã¦ã€${productName}ã‚’ä½œã£ã¦ãã ã•ã„`,
        specialInstruction: organicReactant.formula,
        baseAmount: product.coefficient * (0.5 + Math.random() * 1.0), // 0.5-1.5å€
        reaction: reaction
      };
    }
  }
  
  // é€šå¸¸ã®æ³¨æ–‡
  return {
    reactionId: reaction.id,
    targetProduct: product.formula,
    orderText: `${productName}ã‚’ä½œã£ã¦ãã ã•ã„`,
    baseAmount: product.coefficient * (0.5 + Math.random() * 1.0), // 0.5-1.5å€
    reaction: reaction
  };
}

// å®¢ã‚¿ã‚¤ãƒ—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠï¼ˆã‚¹ã‚­ãƒ«è£œæ­£ä»˜ãï¼‰
function selectRandomCustomerType(userData?: any): CustomerType {
  // å£ã‚³ãƒŸè©•ä¾¡ã‚¹ã‚­ãƒ«ã«ã‚ˆã‚‹VIPç¢ºç‡å€ç‡
  const wordOfMouthLevel = userData?.skills?.word_of_mouth || 0;
  const vipMultipliers = [1.0, 1.5, 2.0, 3.0]; // ãƒ¬ãƒ™ãƒ«0,1,2,3ã®å€ç‡
  const vipMultiplier = vipMultipliers[Math.min(wordOfMouthLevel, 3)];
  
  // å‹•çš„ç¢ºç‡è¨ˆç®—
  const baseProbabilities = {
    normal: 0.60,
    rare: 0.25,
    'super rare': 0.10,
    vip: 0.05
  };
  
  // VIPç¢ºç‡ã‚’å€ç‡ã§èª¿æ•´ã—ã€Normalç¢ºç‡ã‚’èª¿æ•´
  const adjustedVipProb = Math.min(0.30, baseProbabilities.vip * vipMultiplier); // æœ€å¤§30%ã¾ã§
  const vipIncrease = adjustedVipProb - baseProbabilities.vip;
  const adjustedNormalProb = Math.max(0.20, baseProbabilities.normal - vipIncrease); // æœ€ä½20%ã¯ä¿æŒ
  
  const adjustedProbabilities = {
    normal: adjustedNormalProb,
    rare: baseProbabilities.rare,
    'super rare': baseProbabilities['super rare'],
    vip: adjustedVipProb
  };
  
  // ç¢ºç‡ã®æ­£è¦åŒ–ï¼ˆåˆè¨ˆãŒ1.0ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ï¼‰
  const totalProb = Object.values(adjustedProbabilities).reduce((sum, prob) => sum + prob, 0);
  Object.keys(adjustedProbabilities).forEach(key => {
    adjustedProbabilities[key as keyof typeof adjustedProbabilities] /= totalProb;
  });
  
  const rand = Math.random();
  let cumulative = 0;
  
  for (const [type, probability] of Object.entries(adjustedProbabilities)) {
    cumulative += probability;
    if (rand <= cumulative) {
      return type as CustomerType;
    }
  }
  
  return 'normal'; // fallback
}

// å®¢ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆï¼ˆç”¨é€”ãƒ»ç›®çš„ãƒ™ãƒ¼ã‚¹ï¼‰
function generateCustomerComment(productName: string, customerType: CustomerType, formula: string): string {
  // å„åŒ–å­¦ç‰©è³ªã®ç”¨é€”ãƒ»ç›®çš„åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
  const usageComments: Record<string, string[]> = {
    // Level 1 products (é€šå¸¸æ•°å­—ç‰ˆã®ã¿)
    'H2O': [
      'ã®ã©ãŒã‹ã‚ã„ãŸï¼é£²ã¿æ°´ã¨ã—ã¦æ°´ã‚’ä½œã£ã¦ãã‚Œï¼',
      'æ¤ç‰©ã¸ã®æ°´ã‚„ã‚Šã«ç´”ç²‹ãªæ°´ãŒå¿…è¦ã ï¼',
      'æ–™ç†ã«ä½¿ã†æ¸…æ½”ãªæ°´ãŒã»ã—ã„ã‚“ã ï¼',
      'åŒ–å­¦å®Ÿé¨“ç”¨ã®è’¸ç•™æ°´ã‚’ä½œã£ã¦ãã‚Œï¼'
    ],
    'MgO': [
      'èƒƒè–¬ã¨ã—ã¦åˆ¶é…¸å‰¤ã«é…¸åŒ–ãƒã‚°ãƒã‚·ã‚¦ãƒ ãŒå¿…è¦ã ï¼',
      'è£½é‰„æ‰€ã®è€ç«ã‚Œã‚“ãŒè£½é€ ã«ä½¿ã„ãŸã„ï¼',
      'ä¾¿ç§˜è–¬ã®åŸæ–™ã¨ã—ã¦é…¸åŒ–ãƒã‚°ãƒã‚·ã‚¦ãƒ ã‚’ï¼',
      'ã‚»ãƒ¡ãƒ³ãƒˆå·¥å ´ã§ç‰¹æ®Šã‚»ãƒ¡ãƒ³ãƒˆä½œã‚Šã«ä½¿ã†ã‚ˆï¼'
    ],
    'Al2O3': [
      'ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ è£½éŒ¬ã®åŸæ–™ã¨ã—ã¦é…¸åŒ–ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ãŒå¿…è¦ï¼',
      'ã‚µãƒ³ãƒ‰ãƒšãƒ¼ãƒ‘ãƒ¼ã®ç ”ç£¨å‰¤ã«ä½¿ã„ãŸã„ã‚“ã ï¼',
      'äººå·¥ãƒ«ãƒ“ãƒ¼è£½é€ ã«é«˜ç´”åº¦é…¸åŒ–ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'ã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹å·¥å ´ã§è€ç†±ææ–™ã¨ã—ã¦ä½¿ã†ã‚ˆï¼'
    ],
    'NH3': [
      'è¾²æ¥­ç”¨çª’ç´ è‚¥æ–™ã®åŸæ–™ã¨ã—ã¦ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢ãŒå¿…è¦ã ï¼',
      'å†·å‡ã‚·ã‚¹ãƒ†ãƒ ã®å†·åª’ã¨ã—ã¦ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢ã‚’ä½¿ã„ãŸã„ï¼',
      'æ´—å‰¤è£½é€ ã§ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢æ°´ã‚’ä½œã‚‹ã‚“ã ï¼',
      'ãƒãƒ¼ãƒãƒ¼æ³•ã§ä½œã£ãŸé«˜ç´”åº¦ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢ãŒã»ã—ã„ï¼'
    ],
    'CO2': [
      'ç‚­é…¸é£²æ–™è£½é€ ã«é£Ÿå“ã‚°ãƒ¬ãƒ¼ãƒ‰ã®äºŒé…¸åŒ–ç‚­ç´ ã‚’ï¼',
      'æ¶ˆç«å™¨ã®ä¸ç‡ƒæ€§ã‚¬ã‚¹ã¨ã—ã¦ä½¿ã„ãŸã„ï¼',
      'ãƒ‰ãƒ©ã‚¤ã‚¢ã‚¤ã‚¹è£½é€ ã«æ¶²ä½“äºŒé…¸åŒ–ç‚­ç´ ãŒå¿…è¦ã ï¼',
      'æ¤ç‰©å·¥å ´ã§å…‰åˆæˆä¿ƒé€²ç”¨ã®CO2ã‚’ï¼'
    ],
    'NaCl': [
      'æ–™ç†ã®åŸºæœ¬èª¿å‘³æ–™ã¨ã—ã¦é£Ÿå¡©ã‚’ä½œã£ã¦ãã‚Œï¼',
      'é“è·¯ã®å‡çµé˜²æ­¢å‰¤ã¨ã—ã¦èé›ªå¡©ãŒå¿…è¦ã ï¼',
      'é£Ÿå“ä¿å­˜ç”¨ã®å¤©ç„¶å¡©ãŒã»ã—ã„ã‚“ã ï¼',
      'é›»æ°—åˆ†è§£ã§ãƒŠãƒˆãƒªã‚¦ãƒ è£½é€ ã®åŸæ–™ã¨ã—ã¦ï¼'
    ],
    'H2': [
      'ç‡ƒæ–™é›»æ± è»Šã®ç‡ƒæ–™ã¨ã—ã¦æ°´ç´ ã‚¬ã‚¹ãŒå¿…è¦ã ï¼',
      'é‡‘å±ç²¾éŒ¬ã®é‚„å…ƒå‰¤ã¨ã—ã¦ä½¿ã„ãŸã„ï¼',
      'ã‚¯ãƒªãƒ¼ãƒ³ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨ã—ã¦æ°´ç´ ã‚’è²¯è”µã—ãŸã„ï¼',
      'åŒ–å­¦åˆæˆã®åŸæ–™ã‚¬ã‚¹ã¨ã—ã¦ç´”æ°´ç´ ã‚’ï¼'
    ],
    'ZnCl2': [
      'ä¹¾é›»æ± ã®ææ–™ã«å¡©åŒ–äºœé‰›ã‚’ï¼',
      'ã¯ã‚“ã ä»˜ã‘ã®åŠ©å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'é˜²è…å‰¤ã¨ã—ã¦å¡©åŒ–äºœé‰›ãŒæ¬²ã—ã„ã€‚',
      'ç¹”ç‰©ã®é˜²æ°´åŠ å·¥ã«ä½¿ã„ãŸã„ã€‚'
    ],
    'FeCl2': [
      'æ’æ°´å‡¦ç†ã«å¡©åŒ–é‰„ã‚’ä½¿ã†ã‚“ã ã€‚',
      'æŸ“æ–™ã®åª’æŸ“å‰¤ã¨ã—ã¦å¿…è¦ã ã‚ˆã€‚',
      'é‚„å…ƒå‰¤ã¨ã—ã¦å¡©åŒ–é‰„ã‚’ï¼',
      'éŠ…ã‚¨ãƒƒãƒãƒ³ã‚°ã«ä½¿ã„ãŸã„ã€‚'
    ],
    'MgCl2': [
      'èé›ªå‰¤ã¨ã—ã¦å¡©åŒ–ãƒã‚°ãƒã‚·ã‚¦ãƒ ã‚’ï¼',
      'è±†è…ä½œã‚Šã®å‡å›ºå‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'é˜²å¡µå‰¤ã¨ã—ã¦é“è·¯ã«æ’’ããŸã„ã€‚',
      'æ¶ˆç«å‰¤ã®åŸæ–™ã«ã™ã‚‹ã‚“ã ã€‚'
    ],
    'AlCl3': [
      'è§¦åª’ã¨ã—ã¦å¡©åŒ–ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'åˆ¶æ±—å‰¤ã®æˆåˆ†ã«ä½¿ã†ã‚ˆã€‚',
      'çŸ³æ²¹ç²¾è£½ã®è§¦åª’ã¨ã—ã¦å¿…è¦ã ã€‚',
      'æŸ“æ–™ã®åª’æŸ“å‰¤ã«ä½¿ã„ãŸã„ã€‚'
    ],
    'ZnSO4': [
      'ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆã®äºœé‰›ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'è¾²æ¥­ã®å¾®é‡è¦ç´ è‚¥æ–™ã«ï¼',
      'æœ¨æé˜²è…å‰¤ã¨ã—ã¦ç¡«é…¸äºœé‰›ã‚’ã€‚',
      'çœ¼è–¬ã®æˆåˆ†ã«ä½¿ã„ãŸã„ã€‚'
    ],
    'FeSO4': [
      'è²§è¡€æ²»ç™‚ã®é‰„å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'èŠç”Ÿã®è‹”å–ã‚Šã«ç¡«é…¸é‰„ã‚’ï¼',
      'æ°´å‡¦ç†ã®å‡é›†å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'ã‚¤ãƒ³ã‚¯ã®åŸæ–™ã«ä½¿ã„ãŸã„ã€‚'
    ],
    'MgSO4': [
      'å…¥æµ´å‰¤ã®ã‚¨ãƒ—ã‚½ãƒ å¡©ã¨ã—ã¦ï¼',
      'è‚¥æ–™ã®è‹¦åœŸã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'ä¾¿ç§˜è–¬ã¨ã—ã¦ç¡«é…¸ãƒã‚°ãƒã‚·ã‚¦ãƒ ã‚’ã€‚',
      'è±†è…ä½œã‚Šã®å‡å›ºå‰¤ã«ï¼'
    ],
    'Al2(SO4)3': [
      'æµ„æ°´å ´ã®å‡é›†å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'ç´™ã®å®šç€å‰¤ã«ç¡«é…¸ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'æŸ“è‰²ã®åª’æŸ“å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'æ¶ˆç«å™¨ã®ä¸­èº«ã«ä½¿ã„ãŸã„ã€‚'
    ],
    'CaCl2': [
      'èé›ªå‰¤ã¨ã—ã¦å¡©åŒ–ã‚«ãƒ«ã‚·ã‚¦ãƒ ã‚’ï¼',
      'é£Ÿå“ã®ä¹¾ç‡¥å‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã®å‡çµé˜²æ­¢å‰¤ã«ã€‚',
      'é™¤æ¹¿å‰¤ã¨ã—ã¦ä½¿ã„ãŸã„ã€‚'
    ],
    'CuO': [
      'é™¶ç£å™¨ã®ç€è‰²å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'æ®ºèŒå‰¤ã¨ã—ã¦é…¸åŒ–éŠ…ã‚’ï¼',
      'ã‚¬ãƒ©ã‚¹ã®ç€è‰²ã«ä½¿ã„ãŸã„ã€‚',
      'èˆ¹åº•å¡—æ–™ã®é˜²æ±šå‰¤ã¨ã—ã¦ã€‚'
    ],
    'Fe2O3': [
      'èµ¤ã„é¡”æ–™ã¨ã—ã¦é…¸åŒ–é‰„ã‚’ï¼',
      'ç ”ç£¨å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'ç£æ€§ææ–™ã®åŸæ–™ã«å¿…è¦ã ã€‚',
      'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã®ç€è‰²å‰¤ã«ã€‚'
    ],
    'HCl': [
      'èƒƒé…¸ã®è£œå……ã«å¡©é…¸ã‚’ï¼',
      'é‡‘å±ã®é…¸æ´—ã„ã«ä½¿ã†ã‚ˆã€‚',
      'pHã®èª¿æ•´å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'åŒ–å­¦å®Ÿé¨“ã®è©¦è–¬ã¨ã—ã¦ã€‚'
    ],


    // Level 2 products


    // Level 3 products
    'Na2SO4': [
      'æ´—å‰¤ã®åŸæ–™ã«ç¡«é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ã‚’ï¼',
      'ã‚¬ãƒ©ã‚¹è£½é€ ã«ä½¿ã†ã‚ˆã€‚',
      'ç´™ãƒ‘ãƒ«ãƒ—ã®è£½é€ ã«å¿…è¦ã ã€‚',
      'æŸ“è‰²å·¥æ¥­ã®åŠ©å‰¤ã¨ã—ã¦ã€‚'
    ],
    'CH3COONa': [
      'é£Ÿå“æ·»åŠ ç‰©ã¨ã—ã¦é…¢é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ã‚’ï¼',
      'ã‚«ã‚¤ãƒ­ã®ç™ºç†±å‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'ç·©è¡å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'é˜²è…å‰¤ã¨ã—ã¦ä½¿ã„ãŸã„ã€‚'
    ],
    'KNO3': [
      'è‚¥æ–™ã¨ã—ã¦ç¡é…¸ã‚«ãƒªã‚¦ãƒ ã‚’ï¼',
      'èŠ±ç«ã®é…¸åŒ–å‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'é£Ÿå“ã®ä¿å­˜æ–™ã¨ã—ã¦å¿…è¦ã ã€‚',
      'ãƒ­ã‚±ãƒƒãƒˆç‡ƒæ–™ã®é…¸åŒ–å‰¤ã«ã€‚'
    ],
    'Ca(NO3)2': [
      'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã®æ€¥çµå‰¤ã¨ã—ã¦ï¼',
      'è‚¥æ–™ã«ç¡é…¸ã‚«ãƒ«ã‚·ã‚¦ãƒ ã‚’ä½¿ã†ã‚ˆã€‚',
      'èŠ±ç«ã®ç€è‰²å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'å»ƒæ°´å‡¦ç†ã®å‡é›†å‰¤ã«ã€‚'
    ],
    'KCl': [
      'è‚¥æ–™ã¨ã—ã¦å¡©åŒ–ã‚«ãƒªã‚¦ãƒ ã‚’ï¼',
      'åŒ»ç™‚ç”¨ã®é›»è§£è³ªè£œå……ã«ã€‚',
      'é£Ÿå¡©ä»£æ›¿å“ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'æ³¨å°„è–¬ã®æˆåˆ†ã«å¿…è¦ã ã€‚'
    ],
    'K2SO4': [
      'ç„¡å¡©ç´ è‚¥æ–™ã¨ã—ã¦ä½¿ã†ã‚ˆï¼',
      'ã‚¬ãƒ©ã‚¹è£½é€ ã«ç¡«é…¸ã‚«ãƒªã‚¦ãƒ ã‚’ã€‚',
      'ç«è–¬ã®é…¸åŒ–å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'åŒ»è–¬å“ã®åŸæ–™ã«ä½¿ã„ãŸã„ã€‚'
    ],
    'CH3COOK': [
      'é£Ÿå“ã®ä¿å­˜æ–™ã¨ã—ã¦ä½¿ã†ã‚ˆï¼',
      'é™¤æ°·å‰¤ã«é…¢é…¸ã‚«ãƒªã‚¦ãƒ ã‚’ã€‚',
      'ç·©è¡æ¶²ã®èª¿è£½ã«å¿…è¦ã ã€‚',
      'åŒ»è–¬å“ã®åŸæ–™ã¨ã—ã¦ã€‚'
    ],
    'CaCO3': [
      'ãƒãƒ§ãƒ¼ã‚¯ã®åŸæ–™ã«ç‚­é…¸ã‚«ãƒ«ã‚·ã‚¦ãƒ ã‚’ï¼',
      'èƒƒè–¬ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'æ­¯ç£¨ãç²‰ã®ç ”ç£¨å‰¤ã«ã€‚',
      'ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã®å……å¡«å‰¤ã¨ã—ã¦ã€‚'
    ],
    'NH4Cl': [
      'ä¹¾é›»æ± ã®ææ–™ã«å¡©åŒ–ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'ã¯ã‚“ã ä»˜ã‘ã®åŠ©å‰¤ã¨ã—ã¦ã€‚',
      'å»ç—°è–¬ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'è‚¥æ–™ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    '(NH4)2SO4': [
      'è‚¥æ–™ã¨ã—ã¦ç¡«é…¸ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'ãƒ‘ãƒ³ã®æ”¹è‰¯å‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'æ¶ˆç«å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'çš®ãªã‚ã—ã®åŠ©å‰¤ã¨ã—ã¦ã€‚'
    ],

    // Level 3 products (ç¶šã)
    'Na2S': [
      'æŸ“è‰²å·¥æ¥­ã®é‚„å…ƒå‰¤ã¨ã—ã¦ç¡«åŒ–ãƒŠãƒˆãƒªã‚¦ãƒ ã‚’ï¼',
      'çš®ãªã‚ã—ã®è„±æ¯›å‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'å†™çœŸç¾åƒã®è–¬å“ã¨ã—ã¦ã€‚',
      'é‰±ç‰©æµ®é¸ã®è–¬å‰¤ã«å¿…è¦ã ã€‚'
    ],
    'K2S': [
      'æŸ“è‰²ã®é‚„å…ƒå‰¤ã¨ã—ã¦ç¡«åŒ–ã‚«ãƒªã‚¦ãƒ ã‚’ï¼',
      'æ¯›é«ªé™¤å»å‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'é‡‘å±ç²¾éŒ¬ã®è–¬å‰¤ã¨ã—ã¦ã€‚',
      'åŒ–å­¦åˆ†æã®è©¦è–¬ã«å¿…è¦ã ã€‚'
    ],
    'CaS': [
      'å¤œå…‰å¡—æ–™ã¨ã—ã¦ç¡«åŒ–ã‚«ãƒ«ã‚·ã‚¦ãƒ ã‚’ï¼',
      'è„±æ¯›å‰¤ã«ä½¿ã†ã‚ˆã€‚',
      'ç™ºå…‰ææ–™ã¨ã—ã¦å¿…è¦ã ã€‚',
      'é™¤è‰å‰¤ã®åŸæ–™ã¨ã—ã¦ã€‚'
    ],
    'BaS': [
      'å¤œå…‰å¡—æ–™ã«ç¡«åŒ–ãƒãƒªã‚¦ãƒ ã‚’ï¼',
      'ç™ºå…‰ææ–™ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'Xç·šè¨ºæ–­ã®é€ å½±å‰¤åŸæ–™ã«ã€‚',
      'è›å…‰ææ–™ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'NH4NO3': [
      'çˆ†è–¬ã¨ã—ã¦ç¡é…¸ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'è‚¥æ–™ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'èŠ±ç«ã®é…¸åŒ–å‰¤ã«å¿…è¦ã ã€‚',
      'å†·å´ãƒ‘ãƒƒã‚¯ã®ææ–™ã¨ã—ã¦ã€‚'
    ],
    'CH3COONH4': [
      'é£Ÿå“ä¿å­˜æ–™ã¨ã—ã¦é…¢é…¸ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'ç·©è¡æ¶²ã®èª¿è£½ã«ä½¿ã†ã‚ˆã€‚',
      'åŒ»è–¬å“ã®åŸæ–™ã¨ã—ã¦ã€‚',
      'æŸ“è‰²ã®åª’æŸ“å‰¤ã«å¿…è¦ã ã€‚'
    ],
    'NH4F': [
      'ã‚¬ãƒ©ã‚¹ã‚¨ãƒƒãƒãƒ³ã‚°ã«ãƒ•ãƒƒåŒ–ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ã‚’ï¼',
      'æœ¨æé˜²è…å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'é‡‘å±è¡¨é¢å‡¦ç†ã«å¿…è¦ã ã€‚',
      'æ®ºè™«å‰¤ã®åŸæ–™ã¨ã—ã¦ã€‚'
    ],
    'NaF': [
      'æ­¯ç£¨ãç²‰ã®è™«æ­¯äºˆé˜²ã«ãƒ•ãƒƒåŒ–ãƒŠãƒˆãƒªã‚¦ãƒ ã‚’ï¼',
      'æ®ºé¼ å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'æ°´é“æ°´ã®ãƒ•ãƒƒç´ æ·»åŠ ã«ã€‚',
      'æœ¨æé˜²è…å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'KF': [
      'åŒ–å­¦è©¦è–¬ã¨ã—ã¦ãƒ•ãƒƒåŒ–ã‚«ãƒªã‚¦ãƒ ã‚’ï¼',
      'ã‚¬ãƒ©ã‚¹ã‚¨ãƒƒãƒãƒ³ã‚°ã«ä½¿ã†ã‚ˆã€‚',
      'æ®ºè™«å‰¤ã®åŸæ–™ã¨ã—ã¦ã€‚',
      'æ­¯ç§‘æ²»ç™‚ã®è–¬å‰¤ã«å¿…è¦ã ã€‚'
    ],
    'CaF2': [
      'å…‰å­¦ãƒ¬ãƒ³ã‚ºã®ææ–™ã«ãƒ•ãƒƒåŒ–ã‚«ãƒ«ã‚·ã‚¦ãƒ ã‚’ï¼',
      'è£½é‰„ã®åŠ©å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'ãƒ¬ãƒ¼ã‚¶ãƒ¼çµæ™¶ã®ææ–™ã«ã€‚',
      'ãƒ•ãƒƒç´ è£½é€ ã®åŸæ–™ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'CaSO4': [
      'çŸ³è†ãƒœãƒ¼ãƒ‰ã®ææ–™ã«ç¡«é…¸ã‚«ãƒ«ã‚·ã‚¦ãƒ ã‚’ï¼',
      'åŒ»ç™‚ç”¨ã‚®ãƒ—ã‚¹ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'ã‚»ãƒ¡ãƒ³ãƒˆã®èª¿æ•´å‰¤ã«ã€‚',
      'è±†è…ã®å‡å›ºå‰¤ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],

    // Level 4 products (ç¶šã)
    'KBr': [
      'å†™çœŸãƒ•ã‚£ãƒ«ãƒ ã®ææ–™ã«è‡­åŒ–ã‚«ãƒªã‚¦ãƒ ã‚’ï¼',
      'é®é™å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'èµ¤å¤–ç·šæ¤œå‡ºå™¨ã®ææ–™ã«ã€‚',
      'åŒ–å­¦åˆ†æã®è©¦è–¬ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'Cu(NO3)2': [
      'ãƒ¡ãƒƒã‚­æ¶²ã«ç¡é…¸éŠ…ã‚’ï¼',
      'è§¦åª’ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'æŸ“è‰²ã®åª’æŸ“å‰¤ã«ã€‚',
      'æ®ºèŒå‰¤ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'NO': [
      'è¡€ç®¡æ‹¡å¼µæ²»ç™‚ã«ä¸€é…¸åŒ–çª’ç´ ã‚’ï¼',
      'åŒ–å­¦åˆæˆã®ä¸­é–“ä½“ã¨ã—ã¦ã€‚',
      'æ’ã‚¬ã‚¹æµ„åŒ–ã®æŒ‡æ¨™ã«ã€‚',
      'åŒ»ç™‚ã‚¬ã‚¹ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚'
    ],
    'NO2': [
      'ç¡é…¸è£½é€ ã®åŸæ–™ã«äºŒé…¸åŒ–çª’ç´ ã‚’ï¼',
      'åŒ–å­¦åˆæˆã«ä½¿ã†ã‚ˆã€‚',
      'é…¸åŒ–å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'åˆ†æè©¦è–¬ã¨ã—ã¦ã€‚'
    ],
    'Fe': [
      'å»ºç¯‰è³‡æã¨ã—ã¦é‰„ã‚’ï¼',
      'ç£çŸ³ã®ææ–™ã«ä½¿ã†ã‚ˆã€‚',
      'æ „é¤Šè£œçµ¦ã®é‰„åˆ†ã¨ã—ã¦ã€‚',
      'é‚„å…ƒå‰¤ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'HClO': [
      'æ¼‚ç™½å‰¤ã¨ã—ã¦æ¬¡äºœå¡©ç´ é…¸ã‚’ï¼',
      'æ¶ˆæ¯’æ¶²ã«ä½¿ã†ã‚ˆã€‚',
      'ãƒ—ãƒ¼ãƒ«ã®æ®ºèŒå‰¤ã«ã€‚',
      'ä¸Šæ°´é“ã®æ¶ˆæ¯’ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    // Level 4 products
    'MnCl2': [
      'ä¹¾é›»æ± ã®ææ–™ã«å¡©åŒ–ãƒãƒ³ã‚¬ãƒ³ã‚’ï¼',
      'è§¦åª’ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'æŸ“è‰²ã®åª’æŸ“å‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'è‚¥æ–™ã®å¾®é‡è¦ç´ ã¨ã—ã¦ã€‚'
    ],
    'Cl2': [
      'ãƒ—ãƒ¼ãƒ«ã®æ¶ˆæ¯’ã«å¡©ç´ ã‚’ï¼',
      'æ¼‚ç™½å‰¤ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'ä¸Šæ°´é“ã®æ®ºèŒã«å¿…è¦ã ã€‚',
      'PVCè£½é€ ã®åŸæ–™ã¨ã—ã¦ã€‚'
    ],
    'I2': [
      'æ¶ˆæ¯’è–¬ã¨ã—ã¦ãƒ¨ã‚¦ç´ ã‚’ï¼',
      'ç”²çŠ¶è…ºæ²»ç™‚ã«ä½¿ã†ã‚ˆã€‚',
      'å†™çœŸç¾åƒã®ææ–™ã¨ã—ã¦ã€‚',
      'è©¦è–¬ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'CuSO4': [
      'è¾²è–¬ã¨ã—ã¦ç¡«é…¸éŠ…ã‚’ï¼',
      'ãƒ¡ãƒƒã‚­æ¶²ã«ä½¿ã†ã‚ˆã€‚',
      'æ®ºèŒå‰¤ã¨ã—ã¦å¿…è¦ã ã€‚',
      'é’ã„ç‚è‰²åå¿œã®å®Ÿé¨“ã«ã€‚'
    ],
    'SO2': [
      'ãƒ¯ã‚¤ãƒ³ã®é…¸åŒ–é˜²æ­¢å‰¤ã¨ã—ã¦ï¼',
      'æ¼‚ç™½å‰¤ã«äºŒé…¸åŒ–ç¡«é»„ã‚’ã€‚',
      'å†·åª’ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚',
      'æ®ºèŒå‰¤ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'AgNO3': [
      'å†™çœŸç¾åƒã«ç¡é…¸éŠ€ã‚’ï¼',
      'é¡ã®è£½é€ ã«ä½¿ã†ã‚ˆã€‚',
      'çœ¼ç§‘ã®æ²»ç™‚è–¬ã¨ã—ã¦ã€‚',
      'è©¦è–¬ã¨ã—ã¦å¿…è¦ã ã€‚'
    ],
    'P4O10': [
      'ä¹¾ç‡¥å‰¤ã¨ã—ã¦äº”é…¸åŒ–äºŒãƒªãƒ³ã‚’ï¼',
      'åŒ–å­¦åˆæˆã®è„±æ°´å‰¤ã«ã€‚',
      'ãƒªãƒ³é…¸è£½é€ ã®åŸæ–™ã¨ã—ã¦ã€‚',
      'è§¦åª’ã¨ã—ã¦ä½¿ã†ã‚ˆã€‚'
    ]
  };

  // åŒ–å­¦å¼ã‚’æ­£è¦åŒ–ï¼ˆä¸‹ä»˜ãæ–‡å­—ã‚’é€šå¸¸ã®æ•°å­—ã«å¤‰æ›ï¼‰
  const normalizeFormula = (formula: string): string => {
    return formula
      .replace(/â‚‚/g, '2')
      .replace(/â‚ƒ/g, '3')
      .replace(/â‚„/g, '4')
      .replace(/â‚…/g, '5')
      .replace(/â‚†/g, '6')
      .replace(/â‚‡/g, '7')
      .replace(/â‚ˆ/g, '8')
      .replace(/â‚‰/g, '9')
      .replace(/â‚€/g, '0')
      .replace(/â‚/g, '1');
  };

  const normalizedFormula = normalizeFormula(formula);
  
  // ç”¨é€”ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
  const baseComment = usageComments[normalizedFormula] 
    ? usageComments[normalizedFormula][Math.floor(Math.random() * usageComments[normalizedFormula].length)]
    : `${productName}ãŒå¿…è¦ãªã‚“ã ã€‚ç”¨é€”ã¯ç§˜å¯†ã ã‚ˆã€‚`;

  // å®¢ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦è¡¨ç¾ã‚’èª¿æ•´
  switch (customerType) {
    case 'rare':
      return baseComment.replace(/ï¼$/, 'ï¼å¤§é‡ã«é ¼ã‚€ï¼');
    case 'super rare':
      return baseComment.replace(/ï¼$/, 'ï¼å·¥å ´ãƒ¬ãƒ™ãƒ«ã§å¤§é‡ç”Ÿç”£ã—ã¦ãã‚Œï¼');
    case 'vip':
      return baseComment.replace(/ã€‚$/, 'ã€‚æœ€é«˜å“è³ªã§ãŠé¡˜ã„ã—ã¾ã™ã€‚').replace(/ï¼$/, 'ã€‚VIPä»•æ§˜ã§ç‰¹åˆ¥ã«ä½œã£ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ');
    default:
      return baseComment;
  }
}
function getProductDisplayName(formula: string): string {
  const names: Record<string, string> = {
    // Level 1 products
    'H2O': 'æ°´',
    'MgO': 'é…¸åŒ–ãƒã‚°ãƒã‚·ã‚¦ãƒ ',
    'Al2O3': 'é…¸åŒ–ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ',
    'NH3': 'ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢',
    'ZnCl2': 'å¡©åŒ–äºœé‰›',
    'FeCl2': 'å¡©åŒ–é‰„(II)',
    'MgCl2': 'å¡©åŒ–ãƒã‚°ãƒã‚·ã‚¦ãƒ ',
    'AlCl3': 'å¡©åŒ–ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ',
    'ZnSO4': 'ç¡«é…¸äºœé‰›',
    'FeSO4': 'ç¡«é…¸é‰„(II)',
    'MgSO4': 'ç¡«é…¸ãƒã‚°ãƒã‚·ã‚¦ãƒ ',
    'Al2(SO4)3': 'ç¡«é…¸ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ',
    'CaCl2': 'å¡©åŒ–ã‚«ãƒ«ã‚·ã‚¦ãƒ ',
    'CuO': 'é…¸åŒ–éŠ…(II)',
    'Fe2O3': 'é…¸åŒ–é‰„(III)',
    'HCl': 'å¡©åŒ–æ°´ç´ ',
    'NaCl': 'å¡©åŒ–ãƒŠãƒˆãƒªã‚¦ãƒ ',
    'H2': 'æ°´ç´ ',
    
    // Level 2 products
    'CO2': 'äºŒé…¸åŒ–ç‚­ç´ ',
    
    // Level 3 products
    'Na2SO4': 'ç¡«é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ',
    'CH3COONa': 'é…¢é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ',
    'KNO3': 'ç¡é…¸ã‚«ãƒªã‚¦ãƒ ',
    'Ca(NO3)2': 'ç¡é…¸ã‚«ãƒ«ã‚·ã‚¦ãƒ ',
    'KCl': 'å¡©åŒ–ã‚«ãƒªã‚¦ãƒ ',
    'K2SO4': 'ç¡«é…¸ã‚«ãƒªã‚¦ãƒ ',
    'CH3COOK': 'é…¢é…¸ã‚«ãƒªã‚¦ãƒ ',
    'CaCO3': 'ç‚­é…¸ã‚«ãƒ«ã‚·ã‚¦ãƒ ',
    'NH4Cl': 'å¡©åŒ–ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ',
    '(NH4)2SO4': 'ç¡«é…¸ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ',
    'Na2S': 'ç¡«åŒ–ãƒŠãƒˆãƒªã‚¦ãƒ ',
    'K2S': 'ç¡«åŒ–ã‚«ãƒªã‚¦ãƒ ',
    'CaS': 'ç¡«åŒ–ã‚«ãƒ«ã‚·ã‚¦ãƒ ',
    'BaS': 'ç¡«åŒ–ãƒãƒªã‚¦ãƒ ',
    'NH4NO3': 'ç¡é…¸ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ',
    'CH3COONH4': 'é…¢é…¸ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ',
    'NH4F': 'ãƒ•ãƒƒåŒ–ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ',
    'NaF': 'ãƒ•ãƒƒåŒ–ãƒŠãƒˆãƒªã‚¦ãƒ ',
    'KF': 'ãƒ•ãƒƒåŒ–ã‚«ãƒªã‚¦ãƒ ',
    'CaF2': 'ãƒ•ãƒƒåŒ–ã‚«ãƒ«ã‚·ã‚¦ãƒ ',
    'CaSO4': 'ç¡«é…¸ã‚«ãƒ«ã‚·ã‚¦ãƒ ',
    
    // Level 4 products
    'MnCl2': 'å¡©åŒ–ãƒãƒ³ã‚¬ãƒ³(II)',
    'Cl2': 'å¡©ç´ ',
    'KBr': 'è‡­åŒ–ã‚«ãƒªã‚¦ãƒ ',
    'I2': 'ãƒ¨ã‚¦ç´ ',

    'CuSO4': 'ç¡«é…¸éŠ…(II)',
    'SO2': 'äºŒé…¸åŒ–ç¡«é»„',
    'Cu(NO3)2': 'ç¡é…¸éŠ…(II)',
    'NO': 'ä¸€é…¸åŒ–çª’ç´ ',
    'NO2': 'äºŒé…¸åŒ–çª’ç´ ',
    'Fe': 'é‰„',
    'HClO': 'æ¬¡äºœå¡©ç´ é…¸',
    'P4O10': 'äº”é…¸åŒ–äºŒãƒªãƒ³',
    'AgNO3': 'ç¡é…¸éŠ€',
    
    // Reactants for level 2
    'CH4': 'ãƒ¡ã‚¿ãƒ³',
    'C2H6': 'ã‚¨ã‚¿ãƒ³',
    'C3H8': 'ãƒ—ãƒ­ãƒ‘ãƒ³',
    'C2H4': 'ã‚¨ãƒãƒ¬ãƒ³',
    'C2H2': 'ã‚¢ã‚»ãƒãƒ¬ãƒ³',
    'C6H6': 'ãƒ™ãƒ³ã‚¼ãƒ³',
    'C4H10': 'ãƒ–ã‚¿ãƒ³'
  };
  
  return names[formula] || formula;
}

// å…¨65åå¿œã‹ã‚‰æ³¨æ–‡å€™è£œã‚’ç”Ÿæˆ
const ALL_POSSIBLE_ORDERS: any[] = [];

// Level 1-4 ã®å…¨åå¿œã‹ã‚‰æ³¨æ–‡ã‚’ç”Ÿæˆ
CHEMICAL_REACTIONS.forEach(reaction => {
  // å„ç”Ÿæˆç‰©ã«ã¤ã„ã¦æ³¨æ–‡ã‚’ä½œæˆ
  reaction.products.forEach((product, index) => {
    // æ°´ç´ ã‚¬ã‚¹(H2)ã¯å‰¯ç”Ÿæˆç‰©ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒå¤šã„ã®ã§ã€ä¸»è¦ç”Ÿæˆç‰©ã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹
    if (product.formula === 'H2' && reaction.products.length > 1) return;
    
    const order = createOrderFromReaction(reaction, index);
    if (order) {
      ALL_POSSIBLE_ORDERS.push({
        ...order,
        level: reaction.level
      });
    }
  });
});

// ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸæ³¨æ–‡ã‚’ç”Ÿæˆ
export function generateLevelBasedOrder(userLevel: number, userData?: any): LevelBasedOrder {
  let availableOrders: any[] = [];
  
  // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦åˆ©ç”¨å¯èƒ½ãªæ³¨æ–‡ã‚’æ±ºå®š
  if (userLevel >= 1 && userLevel <= 5) {
    availableOrders = ALL_POSSIBLE_ORDERS.filter(order => order.level <= 2);
  } else if (userLevel >= 6 && userLevel <= 10) {
    availableOrders = ALL_POSSIBLE_ORDERS.filter(order => order.level <= 3);
  } else {
    availableOrders = ALL_POSSIBLE_ORDERS.filter(order => order.level <= 4);
  }
  
  // ãƒ©ãƒ³ãƒ€ãƒ ã«æ³¨æ–‡ã‚’é¸æŠ
  const selectedOrder = availableOrders[Math.floor(Math.random() * availableOrders.length)];
  
  // å®¢ã‚¿ã‚¤ãƒ—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠï¼ˆã‚¹ã‚­ãƒ«è£œæ­£ä»˜ãï¼‰
  const customerType = selectRandomCustomerType(userData);
  const customerConfig = CUSTOMER_TYPES[customerType];
  
  // ã‚­ãƒªã®ã„ã„æ•°å€¤ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
  const molOptions = [0.1, 0.2, 0.25, 0.5, 1.0, 1.5, 2.5, 3.0, 5.0];
  const baseMol = molOptions[Math.floor(Math.random() * molOptions.length)];
  
  // å®¢ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦molæ•°ã‚’èª¿æ•´
  const targetMol = baseMol * customerConfig.molMultiplier;
  
  // å•†å“åã‚’å–å¾—
  const productName = getProductDisplayName(selectedOrder.targetProduct);
  
  // å®¢ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆ
  const customerComment = generateCustomerComment(productName, customerType, selectedOrder.targetProduct);
  
  return {
    level: selectedOrder.level,
    reactionId: selectedOrder.reactionId,
    targetProduct: selectedOrder.targetProduct,
    targetMol,
    orderText: `${selectedOrder.orderText} (${targetMol} mol)`,
    specialInstruction: selectedOrder.specialInstruction,
    reaction: selectedOrder.reaction,
    customerType,
    customerComment,
    bonusMultiplier: customerConfig.bonusMultiplier
  };
}

// æ³¨æ–‡çµ±è¨ˆæƒ…å ±ã‚’å–å¾—ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
export function getOrderStatistics() {
  const levelCounts = { 1: 0, 2: 0, 3: 0, 4: 0 };
  ALL_POSSIBLE_ORDERS.forEach(order => {
    levelCounts[order.level as keyof typeof levelCounts]++;
  });
  
  return {
    total: ALL_POSSIBLE_ORDERS.length,
    byLevel: levelCounts,
    level2WithMaterial: ALL_POSSIBLE_ORDERS.filter(order => 
      order.level === 2 && order.specialInstruction
    ).length
  };
}